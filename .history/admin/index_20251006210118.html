<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel — Lista de Fornecedores</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:820px;margin:40px auto;padding:0 16px}
    h1{font-size:22px;margin-bottom:12px}
    label{display:block;font-weight:600;margin-top:14px}
    input,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;font-size:15px}
    textarea{min-height:110px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{margin-top:18px;display:flex;gap:10px}
    button{padding:12px 16px;border:0;border-radius:12px;cursor:pointer;font-weight:700}
    .save{background:#111;color:#fff}
    .reload{background:#f2f2f2}
    .ok{color:#0a7; margin-left:8px}
    .err{color:#c00; margin-left:8px}
    small{color:#666}
  </style>
</head>
<body>
  <h1>Configurar página/fluxo da <em>Lista de Fornecedores</em></h1>

  <label>Título</label>
  <input id="titulo" placeholder="Lista de Fornecedores de Atacado" />

  <label>Texto persuasivo</label>
  <textarea id="texto" placeholder="Receba a lista completa imediatamente após o pagamento."></textarea>

  <div class="row">
    <div>
      <label>Preço</label>
      <input id="preco" placeholder="R$ 19,90" />
    </div>
    <div>
      <label>WhatsApp de suporte</label>
      <input id="whatsapp_suporte" placeholder="+5565..." />
    </div>
  </div>

  <label>Checkout URL</label>
  <input id="checkout_url" placeholder="https://pay.cakto.com.br/SEU_LINK?orderId={ORDER_ID}" />
  <small>Use <code>{ORDER_ID}</code> para o identificador do pedido que o bot gerar.</small>

  <div class="actions">
    <button class="save" id="btnSave">Salvar</button>
    <button class="reload" id="btnReload">Recarregar</button>
    <span id="status"></span>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const statusEl = $('status');

    async function load() {
      statusEl.textContent = 'carregando...';
      try {
        const cfg = await fetch('/config').then(r => r.json());
        $('titulo').value = cfg.titulo || '';
        $('texto').value = cfg.texto || '';
        $('preco').value = cfg.preco || '';
        $('whatsapp_suporte').value = cfg.whatsapp_suporte || '';
        $('checkout_url').value = cfg.checkout_url || '';
        statusEl.textContent = '';
      } catch (e) {
        statusEl.innerHTML = '<span class="err">falha ao carregar</span>';
      }
    }

    async function save() {
      statusEl.textContent = 'salvando...';
      const body = {
        titulo: $('titulo').value.trim(),
        texto: $('texto').value.trim(),
        preco: $('preco').value.trim(),
        whatsapp_suporte: $('whatsapp_suporte').value.trim(),
        checkout_url: $('checkout_url').value.trim(),
      };
      try {
        const res = await fetch('/config', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(body)
        }).then(r => r.json());
        if (res.ok) {
          statusEl.innerHTML = '<span class="ok">salvo ✔</span>';
        } else {
          statusEl.innerHTML = '<span class="err">erro ao salvar</span>';
        }
      } catch (e) {
        statusEl.innerHTML = '<span class="err">erro ao salvar</span>';
      }
    }

    $('btnSave').onclick = save;
    $('btnReload').onclick = load;
    load();
  </script>
</body>
</html>
